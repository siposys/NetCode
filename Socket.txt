char a[50] = "Hello, world!";
char b[50];
char c[50];

uLong ucompSize = strlen(a)+1; // "Hello, world!" + NULL delimiter.
uLong compSize = compressBound(ucompSize);

// Deflate
compress((Bytef *)b, &compSize, (Bytef *)a, ucompSize);

// Inflate
uncompress((Bytef *)c, &ucompSize, (Bytef *)b, compSize);


//ssl socket in c program
//https://aticleworld.com/ssl-server-client-using-openssl-in-c/
//https://stackoverflow.com/questions/7698488/turn-a-simple-socket-into-an-ssl-socket
//https://wiki.openssl.org/index.php/Simple_TLS_Server
http://fm4dd.com/openssl/sslconnect.shtm
https://www.cs.odu.edu/~cs472/fall11/lectures/ssl_programming.pdf

// ssl socket in java
// check this too -- https://github.com/joshuarabanal/VPN
// Server Side ----------------------------------------------------------------------------
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.PrintStream;
import java.io.PrintWriter;
import java.security.KeyStore;
import javax.net.ssl.KeyManager;
import javax.net.ssl.KeyManagerFactory;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLServerSocket;
import javax.net.ssl.SSLServerSocketFactory;
import javax.net.ssl.SSLSession;
import javax.net.ssl.SSLSocket;
import javax.net.ssl.TrustManager;
import javax.net.ssl.TrustManagerFactory;


public class SSLServer
{
  private boolean isServerDone = false;
  public static int count = 0;
  int port = 443;
  
  public static void main(String[] args)
  {
    System.out.println("Starting SSL Server....");
    
    SSLServer server = new SSLServer();
    if (args.length >= 1) {
      server.port = new Integer(args[0]).intValue();
    }
    server.run();
  }
  
  SSLServer() {}
  
  SSLServer(int port)
  {
    this.port = port;
  }
  
  private SSLContext createSSLContext()
  {
    try
    {
      KeyStore keyStore = KeyStore.getInstance("JKS");
      keyStore.load(new FileInputStream("keystore.jks"), "changeit".toCharArray());
      
      KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance("SunX509");
      keyManagerFactory.init(keyStore, "changeit".toCharArray());
      KeyManager[] km = keyManagerFactory.getKeyManagers();
      
      TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance("SunX509");
      trustManagerFactory.init(keyStore);
      TrustManager[] tm = trustManagerFactory.getTrustManagers();
      
      SSLContext sslContext = SSLContext.getInstance("TLSv1");
      sslContext.init(km, tm, null);
      
      return sslContext;
    }
    catch (Exception ex)
    {
      ex.printStackTrace();
    }
    return null;
  }
  
  public void run()
  {
    SSLContext sslContext = createSSLContext();
    try
    {
      SSLServerSocketFactory sslServerSocketFactory = sslContext.getServerSocketFactory();
      
      SSLServerSocket sslServerSocket = (SSLServerSocket)sslServerSocketFactory.createServerSocket(this.port);
      
      System.out.println("SSL server started");
      while (!this.isServerDone)
      {
        SSLSocket sslSocket = (SSLSocket)sslServerSocket.accept();
        
        count += 1;
        System.out.println("loop count: " + count);
        new ServerThread(sslSocket).start();
      }
    }
    catch (Exception ex)
    {
      ex.printStackTrace();
    }
  }
  
  static class ServerThread
    extends Thread
  {
    private SSLSocket sslSocket = null;
    
    ServerThread(SSLSocket sslSocket)
    {
      this.sslSocket = sslSocket;
    }
    
    public void run()
    {
      this.sslSocket.setEnabledCipherSuites(this.sslSocket.getSupportedCipherSuites());
      try
      {
        this.sslSocket.startHandshake();
        
        SSLSession sslSession = this.sslSocket.getSession();
        
        InputStream inputStream = this.sslSocket.getInputStream();
        OutputStream outputStream = this.sslSocket.getOutputStream();
        
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        PrintWriter printWriter = new PrintWriter(new OutputStreamWriter(outputStream));
        
        String line = null;
        do
        {
          StringBuilder sb = new StringBuilder();
          while ((line = bufferedReader.readLine()) != null)
          {
            sb.append(line);
            if (line.trim().isEmpty()) {
              break;
            }
          }
          System.out.println("server received: " + sb.toString());
          
          printWriter.println("hi, from server");
          
          printWriter.flush();
          System.out.println("******** Response has been sent to the client");
          System.out.println("count: " + SSLServer.count);
          
          this.sslSocket.close();
          if (this.sslSocket == null) {
            break;
          }
        } while ((line = bufferedReader.readLine()) != null);
      }
      catch (Exception localException) {}
      System.out.println("\n\n **** connection with client has been closed waiting for new connection: ");
    }
  }
}












// client section---------------------------------------------------------------------------------------------
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.PrintStream;
import java.io.PrintWriter;
import java.security.KeyStore;
import javax.net.ssl.KeyManager;
import javax.net.ssl.KeyManagerFactory;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSession;
import javax.net.ssl.SSLSocket;
import javax.net.ssl.SSLSocketFactory;
import javax.net.ssl.TrustManager;
import javax.net.ssl.TrustManagerFactory;

public class SSLClient
{
  private String host = "127.0.0.1";
  private int port = 443;
  
  public static void main(String[] args)
  {
    SSLClient client = new SSLClient();
    client.run();
  }
  
  SSLClient() {}
  
  SSLClient(String host, int port)
  {
    this.host = host;
    this.port = port;
  }
  
  private SSLContext createSSLContext()
  {
    try
    {
      KeyStore keyStore = KeyStore.getInstance("JKS");
      keyStore.load(new FileInputStream("keystore.jks"), "changeit".toCharArray());
      
      KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance("SunX509");
      keyManagerFactory.init(keyStore, "changeit".toCharArray());
      KeyManager[] km = keyManagerFactory.getKeyManagers();
      
      TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance("SunX509");
      trustManagerFactory.init(keyStore);
      TrustManager[] tm = trustManagerFactory.getTrustManagers();
      
      SSLContext sslContext = SSLContext.getInstance("TLSv1");
      sslContext.init(km, tm, null);
      
      return sslContext;
    }
    catch (Exception ex)
    {
      ex.printStackTrace();
    }
    return null;
  }
  
  public void run()
  {
    SSLContext sslContext = createSSLContext();
    try
    {
      SSLSocketFactory sslSocketFactory = sslContext.getSocketFactory();
      
      SSLSocket sslSocket = (SSLSocket)sslSocketFactory.createSocket(this.host, this.port);
      
      System.out.println("SSL client 2 started");
      new ClientThread(sslSocket).start();
    }
    catch (Exception ex)
    {
      ex.printStackTrace();
    }
  }
  
  static class ClientThread
    extends Thread
  {
    private SSLSocket sslSocket = null;
    
    ClientThread(SSLSocket sslSocket)
    {
      this.sslSocket = sslSocket;
    }
    
    public void run()
    {
      this.sslSocket.setEnabledCipherSuites(this.sslSocket.getSupportedCipherSuites());
      try
      {
        this.sslSocket.startHandshake();
        
        SSLSession sslSession = this.sslSocket.getSession();
        
        InputStream inputStream = this.sslSocket.getInputStream();
        OutputStream outputStream = this.sslSocket.getOutputStream();
        
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        PrintWriter printWriter = new PrintWriter(new OutputStreamWriter(outputStream));
        
        int count = 0;
        while (count++ < 10)
        {
          String msg = "Hello server: " + count;
          printWriter.println(msg);
          
          printWriter.flush();
          
          System.out.println("Client sent msg: " + msg);
          
          String line = null;
          
          line = bufferedReader.readLine();
          
          System.out.println("***  client Received: " + line);
        }
        this.sslSocket.close();
        
        System.out.println("Client has closed ssl connection");
      }
      catch (Exception localException) {}
      System.out.println("\n\n **** Server Side is not running or Server Down ");
    }
  }
}

